{% extends "base.html" %}
{% block content %}
<div class="card">
  <div class="card-title">
    <span data-i18n="admin.gpu.title">Ustawienia GPU • Menedżer GPU</span>
  </div>
  <div class="small muted" style="margin-top:6px" data-i18n="admin.gpu.subtitle">
    Monitoruj GPU, limity współbieżności i kolejkę zadań. (Autoryzacja później.)
  </div>

  <div class="hr"></div>

  <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 16px;">
    <div class="card" style="margin:0">
      <div class="label" data-i18n="admin.gpu.config">Configuration</div>
      <div class="small muted" data-i18n="admin.gpu.config_desc">
        Limits apply to transcription/diarization tasks started from this server.
      </div>

      <div style="margin-top:10px">
        <div class="small muted" data-i18n="admin.gpu.mem_fraction">GPU memory fraction (soft limit)</div>
        <input id="gpu_mem_fraction" class="input" type="number" min="0.3" max="0.98" step="0.01" value="0.85" />
      </div>

      <div style="margin-top:10px">
        <div class="small muted" data-i18n="admin.gpu.slots_per_gpu">Slots per GPU</div>
        <input id="gpu_slots_per_gpu" class="input" type="number" min="1" max="8" step="1" value="1" />
      </div>

      <div style="margin-top:10px">
        <div class="small muted" data-i18n="admin.gpu.cpu_slots">CPU slots (fallback)</div>
        <input id="gpu_cpu_slots" class="input" type="number" min="1" max="16" step="1" value="1" />
      </div>

      <div style="margin-top:12px; display:flex; gap:10px; align-items:center;">
        <button id="gpu_cfg_save" class="btn" data-i18n="admin.gpu.save">Save</button>
        <span id="gpu_cfg_msg" class="small muted"></span>
      </div>

      <div class="small muted" style="margin-top:10px" data-i18n="admin.gpu.hint">
        Tip: set 0.70–0.85 to keep VRAM headroom and avoid UI freezes.
      </div>
    </div>

    <div class="card" style="margin:0">
      <div class="label" data-i18n="admin.gpu.status">Status</div>
      <div id="gpu_status_summary" class="small muted" style="margin-top:6px"></div>

      <div style="margin-top:10px; overflow:auto;">
        <table class="table" style="min-width:520px">
          <thead>
            <tr>
              <th data-i18n="admin.gpu.col.device">Device</th>
              <th data-i18n="admin.gpu.col.name">Name</th>
              <th data-i18n="admin.gpu.col.vram">VRAM</th>
              <th data-i18n="admin.gpu.col.running">Running</th>
              <th data-i18n="admin.gpu.col.slots">Slots</th>
            </tr>
          </thead>
          <tbody id="gpu_table_body"></tbody>
        </table>
      </div>
    </div>
  </div>

  <div class="hr"></div>

  <div class="card" style="margin:0">
    <div class="label" data-i18n="admin.gpu.jobs">Jobs</div>
    <div class="small muted" data-i18n="admin.gpu.jobs_desc">
      Queued jobs will start automatically when a GPU slot is free.
    </div>

    <div style="margin-top:10px; overflow:auto;">
      <table class="table" style="min-width:1080px">
        <thead>
          <tr>
            <th data-i18n="admin.gpu.jobs.col.when">Created</th>
            <th data-i18n="admin.gpu.jobs.col.task">Task</th>
            <th data-i18n="admin.gpu.jobs.col.kind">Kind</th>
            <th data-i18n="admin.gpu.jobs.col.job_type">Job type</th>
            <th data-i18n="admin.gpu.jobs.col.priority">Priority</th>
            <th data-i18n="admin.gpu.jobs.col.project">Project</th>
            <th data-i18n="admin.gpu.jobs.col.status">Status</th>
            <th data-i18n="admin.gpu.jobs.col.device">Device</th>
            <th data-i18n="admin.gpu.jobs.col.actions">Actions</th>
          </tr>
        </thead>
        <tbody id="gpu_jobs_body"></tbody>
      </table>
    </div>
  </div>
</div>

<script src="/static/admin_gpu.js?v={{ app_version }}"></script>
{% endblock %}
