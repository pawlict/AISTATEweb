{% extends "base.html" %}
{% block content %}
<div class="card">
  <h1 class="h1" data-i18n="nllb.page_title">Ustawienia NLLB</h1>

  <div class="grid">
    <div class="subcard">

      <style>
        /* Inline layout only for NLLB Settings page */
        .nllb-model-row{ display:grid; grid-template-columns: minmax(360px, 520px) 1fr; gap:14px; align-items:start; }
        .nllb-model-left{ min-width: 0; }
        .nllb-model-right{ min-width: 0; }

        .nllb-info-box{
          border: 1px solid rgba(255,255,255,0.10);
          background: rgba(0,0,0,0.08);
          border-radius: 10px;
          padding: 10px 12px;
        }
        .nllb-info-title{ font-weight:600; margin-bottom:6px; }
        .nllb-install-row{ display:flex; gap:8px; align-items:center; margin-top:8px; flex-wrap:wrap; }
        .nllb-install-row .small{ margin:0; }

        .nllb-kv{ display:grid; grid-template-columns: 160px 1fr; gap:6px 12px; }
        .nllb-kv .kv-h{ font-weight:600; opacity:.95; }

        .nllb-warn{
          border: 1px solid rgba(185, 28, 28, 0.22);
          background: rgba(185, 28, 28, 0.10);
          border-radius: 10px;
          padding: 8px 10px;
          margin-top: 10px;
          font-size: 12px;
          color: var(--text);
        }

        @media (max-width: 980px){
          .nllb-model-row{ grid-template-columns: 1fr; }
        }
      </style>

      <!-- Task progress (top) -->
      <div class="label" data-i18n="nllb.task_title"><i data-icon="document" data-size="14"></i> Postęp zadania</div>
      <div class="small"><span data-i18n="common.status">Status</span>: <span id="nllb_task_status">—</span></div>
      <div class="small"><span data-i18n="common.progress">Postęp</span>: <span id="nllb_task_pct">0%</span></div>
      <div class="progress" style="margin-top:10px"><div id="nllb_task_bar"></div></div>

      <div class="row" style="margin-top:10px; flex-wrap:wrap">
        <a class="btn secondary" id="nllb_task_open_logs" href="/logs" style="display:none" data-i18n="nllb.open_logs">Otwórz logi</a>
      </div>

      <div class="hr"></div>

      <!-- Dependencies -->
      <div class="label" data-i18n="nllb.deps_title"><i data-icon="install" data-size="14"></i> Zależności NLLB (Transformers)</div>
      <div class="small" id="nllb_deps_status">—</div>
      <div class="nllb-install-row">
        <button class="btn primary mini" type="button" id="nllb_deps_install_btn"><i data-icon="install" data-size="14"></i> <span data-i18n="nllb.btn.install_deps">Instaluj</span></button>
        <span class="small muted" id="nllb_deps_inline">—</span>
      </div>

      <div class="hr"></div>

      <!-- MODELS -->
      <div>
        <div class="label" data-i18n="nllb.models_title"><i data-icon="globe" data-size="16"></i> Modele NLLB (offline)</div>
        <div class="small muted" data-i18n="nllb.models_desc">Modele NLLB instalują się do cache HuggingFace. Po instalacji będą oznaczone jako „zainstalowane”.</div>

        <div class="hr"></div>

        <!-- FAST -->
        <div class="label" data-i18n="nllb.group.fast">Tłumaczenie szybkie</div>
        <div class="small muted" data-i18n="nllb.group.fast_desc">Szybsze modele (mniejsze), dobre do pracy „na bieżąco”.</div>

        <div class="hr"></div>

        <div class="nllb-model-row">
          <div class="nllb-model-left">
            <div class="label">NLLB — Fast</div>
            <div class="small" id="nllb_fast_status">—</div>
            <select id="nllb_fast_select" class="input" data-mode="fast">
              <option value="" data-i18n="settings.llm_select_placeholder">Wybierz model…</option>
              {% for m in nllb_fast_models %}
                <option value="{{m}}">{{m}}</option>
              {% endfor %}
            </select>

            <div class="nllb-install-row">
              <button class="btn primary mini" type="button" id="nllb_fast_install_btn" data-mode="fast"><i data-icon="install" data-size="14"></i> <span data-i18n="nllb.btn.install_model">Instaluj</span></button>
              <span class="small muted" id="nllb_fast_inline">—</span>
            </div>
          </div>

          <div class="nllb-model-right">
            <div class="nllb-info-box">
              <div class="nllb-info-title small"><i data-icon="info_circle" data-size="14"></i> <span data-i18n="nllb.model_info">Informacje o modelu</span></div>
              <div class="small" id="nllb_fast_info_name">—</div>
              <div id="nllb_fast_info_body" class="small muted" style="margin-top:6px;"></div>
              <div class="nllb-warn" id="nllb_fast_info_warning" style="display:none"></div>
            </div>
          </div>
        </div>

        <div class="hr"></div>

        <!-- ACCURATE -->
        <div class="label" data-i18n="nllb.group.accurate"><i data-icon="deep_search" data-size="14"></i> Tłumaczenie dokładne</div>
        <div class="small muted" data-i18n="nllb.group.accurate_desc">Większe modele (lepsza jakość), wolniejsze i bardziej pamięciożerne.</div>

        <div class="hr"></div>

        <div class="nllb-model-row">
          <div class="nllb-model-left">
            <div class="label">NLLB — Accurate</div>
            <div class="small" id="nllb_accurate_status">—</div>
            <select id="nllb_accurate_select" class="input" data-mode="accurate">
              <option value="" data-i18n="settings.llm_select_placeholder">Wybierz model…</option>
              {% for m in nllb_accurate_models %}
                <option value="{{m}}">{{m}}</option>
              {% endfor %}
            </select>

            <div class="nllb-install-row">
              <button class="btn primary mini" type="button" id="nllb_accurate_install_btn" data-mode="accurate"><i data-icon="install" data-size="14"></i> <span data-i18n="nllb.btn.install_model">Instaluj</span></button>
              <span class="small muted" id="nllb_accurate_inline">—</span>
            </div>
          </div>

          <div class="nllb-model-right">
            <div class="nllb-info-box">
              <div class="nllb-info-title small"><i data-icon="info_circle" data-size="14"></i> <span data-i18n="nllb.model_info">Informacje o modelu</span></div>
              <div class="small" id="nllb_accurate_info_name">—</div>
              <div id="nllb_accurate_info_body" class="small muted" style="margin-top:6px;"></div>
              <div class="nllb-warn" id="nllb_accurate_info_warning" style="display:none"></div>
            </div>
          </div>
        </div>

      </div>

    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/nllb_settings.js?v={{ app_version }}"></script>
{% endblock %}
