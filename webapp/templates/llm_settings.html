{% extends "base.html" %}
{% block content %}
<div class="card">
  <h1 class="h1" data-i18n="llm_settings.page_title">Ustawienia LLM</h1>

  <div class="grid">
    <div class="subcard">
      <div class="label" data-i18n="settings.llm_title"><i data-icon="robot" data-size="14"></i> Modele LLM (Ollama)</div>

      <style>
        /* Inline layout only for LLM Settings page */
        .llm-toolbar-row{ display:flex; align-items:center; gap:10px; flex-wrap:wrap; }
        .llm-toolbar-row .spacer{ flex:1 1 auto; }
        .llm-row{ display:grid; grid-template-columns: minmax(360px, 520px) 1fr; gap:14px; align-items:start; }
        .llm-info-box{
          border: 1px solid rgba(255,255,255,0.10);
          background: rgba(0,0,0,0.08);
          border-radius: 10px;
          padding: 10px 12px;
        }
        .llm-info-title{ font-weight:600; margin-bottom:6px; }
        .llm-info-box .plain-list{ margin:6px 0 0 18px; }
        .llm-info-box .hr{ margin:10px 0; }
        .llm-inline-warn{ margin-top:10px; }
        .llm-install-row{ display:flex; gap:8px; align-items:center; margin-top:8px; flex-wrap:wrap; }
        .llm-install-row .small{ margin:0; }
        @media (max-width: 980px){
          .llm-row{ grid-template-columns: 1fr; }
        }
        .llm-mini-grid{
          display:grid;
          grid-template-columns: 1fr 1fr;
          gap:12px;
        }
        .llm-mini-col{ line-height:1.45; }
        .llm-mini-h{ font-weight:600; margin-bottom:6px; opacity:.95; }
        .llm-mini-cases{
          display:grid;
          grid-template-columns: 1fr 1fr;
          gap:4px 12px;
          margin-top:6px;
        }
        .llm-mini-case{ line-height:1.35; }
        .llm-mini-rec{ line-height:1.45; margin-top:6px; }
        @media (max-width: 980px){
          .llm-mini-grid{ grid-template-columns: 1fr; }
          .llm-mini-cases{ grid-template-columns: 1fr; }
        }
      </style>

      <div class="ollama-status-row llm-toolbar-row" id="llm_ollama_status">
        <span class="status-dot offline" id="llm_status_dot"></span>
        <span class="small" id="llm_status_text" data-i18n="settings.llm_status_checking">Sprawdzanie…</span>
        <span class="small muted" id="llm_status_url"></span>
        <span class="spacer"></span>
        <button class="btn secondary mini" id="llm_refresh_btn" type="button"><i data-icon="refresh" data-size="14"></i> <span data-i18n="settings.llm_refresh">Odśwież listę modeli</span></button>
      </div>

      <div class="small muted" id="llm_refresh_msg" style="margin-top:6px;"></div>

      <div class="hr"></div>

      <!-- QUICK -->
      <div class="llm-row llm-group">
        <div>
          <div class="label" data-i18n="settings.llm_quick_title">Szybka analiza</div>
          <div class="small muted" data-i18n="settings.llm_quick_desc">Model do automatycznej analizy w tle (kilka sekund).</div>
          <select id="llm_quick_select" class="input"></select>

          <div class="llm-install-row">
            <button class="btn primary mini" type="button" id="llm_quick_install_btn" style="display:none;"><i data-icon="install" data-size="14"></i> <span data-i18n="settings.llm_install">Instaluj</span></button>
            <span class="small muted" id="llm_quick_warn"></span>
          </div>
        </div>

        <div>
          <div class="llm-info-box">
            <div class="llm-info-title small"><i data-icon="info_circle" data-size="14"></i> <span data-i18n="settings.llm_info_inline">Informacje o modelu</span></div>
            <div class="small" id="llm_quick_info_name">—</div>
            <div id="llm_quick_info_body" class="small muted" style="margin-top:6px;"></div>
            <div class="llm-warn llm-inline-warn" id="llm_quick_info_warning" style="display:none"></div>
          </div>
        </div>
      </div>

      <div class="hr"></div>

      <!-- DEEP -->
      <div class="llm-row llm-group">
        <div>
          <div class="label" data-i18n="settings.llm_deep_title"><i data-icon="search" data-size="14"></i> Głęboka analiza</div>
          <div class="small muted" data-i18n="settings.llm_deep_desc">Model do szczegółowych raportów (dziesiątki sekund / minuty).</div>
          <select id="llm_deep_select" class="input"></select>

          <div class="llm-install-row">
            <button class="btn primary mini" type="button" id="llm_deep_install_btn" style="display:none;"><i data-icon="install" data-size="14"></i> <span data-i18n="settings.llm_install">Instaluj</span></button>
            <span class="small muted" id="llm_deep_warn"></span>
          </div>
        </div>

        <div>
          <div class="llm-info-box">
            <div class="llm-info-title small"><i data-icon="info_circle" data-size="14"></i> <span data-i18n="settings.llm_info_inline">Informacje o modelu</span></div>
            <div class="small" id="llm_deep_info_name">—</div>
            <div id="llm_deep_info_body" class="small muted" style="margin-top:6px;"></div>
            <div class="llm-warn llm-inline-warn" id="llm_deep_info_warning" style="display:none"></div>
          </div>
        </div>
      </div>

      <div class="hr"></div>

      <!-- VISION / OCR -->
      <div class="llm-row llm-group">
        <div>
          <div class="label" data-i18n="settings.llm_vision_title"><i data-icon="vision" data-size="14"></i> Vision / OCR (dokumenty, faktury)</div>
          <div class="small muted" data-i18n="settings.llm_vision_desc">Model do OCR dokumentów, faktur, rachunków, bilingów.</div>
          <select id="llm_vision_select" class="input"></select>

          <div class="llm-install-row">
            <button class="btn primary mini" type="button" id="llm_vision_install_btn" style="display:none;"><i data-icon="install" data-size="14"></i> <span data-i18n="settings.llm_install">Instaluj</span></button>
            <span class="small muted" id="llm_vision_warn"></span>
          </div>
        </div>

        <div>
          <div class="llm-info-box">
            <div class="llm-info-title small"><i data-icon="info_circle" data-size="14"></i> <span data-i18n="settings.llm_info_inline">Informacje o modelu</span></div>
            <div class="small" id="llm_vision_info_name">—</div>
            <div id="llm_vision_info_body" class="small muted" style="margin-top:6px;"></div>
            <div class="llm-warn llm-inline-warn" id="llm_vision_info_warning" style="display:none"></div>
          </div>
        </div>
      </div>

      <div class="hr"></div>

      <!-- TRANSLATION -->
      <div class="llm-row llm-group">
        <div>
          <div class="label" data-i18n="settings.llm_translation_title"><i data-icon="globe" data-size="16"></i> Tłumaczenia (w tym cyrylica)</div>
          <div class="small muted" data-i18n="settings.llm_translation_desc">Model do tłumaczeń PL/RU/UK/EN. Obsługa cyrylicy.</div>
          <select id="llm_translation_select" class="input"></select>

          <div class="llm-install-row">
            <button class="btn primary mini" type="button" id="llm_translation_install_btn" style="display:none;"><i data-icon="install" data-size="14"></i> <span data-i18n="settings.llm_install">Instaluj</span></button>
            <span class="small muted" id="llm_translation_warn"></span>
          </div>
        </div>

        <div>
          <div class="llm-info-box">
            <div class="llm-info-title small"><i data-icon="info_circle" data-size="14"></i> <span data-i18n="settings.llm_info_inline">Informacje o modelu</span></div>
            <div class="small" id="llm_translation_info_name">—</div>
            <div id="llm_translation_info_body" class="small muted" style="margin-top:6px;"></div>
            <div class="llm-warn llm-inline-warn" id="llm_translation_info_warning" style="display:none"></div>
          </div>
        </div>
      </div>

      <div class="hr"></div>

      <!-- FINANCIAL -->
      <div class="llm-row llm-group">
        <div>
          <div class="label" data-i18n="settings.llm_financial_title"><i data-icon="finance" data-size="14"></i> Analiza finansowa</div>
          <div class="small muted" data-i18n="settings.llm_financial_desc">Model do analizy rachunków, balance check, detekcji hazardu.</div>
          <select id="llm_financial_select" class="input"></select>

          <div class="llm-install-row">
            <button class="btn primary mini" type="button" id="llm_financial_install_btn" style="display:none;"><i data-icon="install" data-size="14"></i> <span data-i18n="settings.llm_install">Instaluj</span></button>
            <span class="small muted" id="llm_financial_warn"></span>
          </div>
        </div>

        <div>
          <div class="llm-info-box">
            <div class="llm-info-title small"><i data-icon="info_circle" data-size="14"></i> <span data-i18n="settings.llm_info_inline">Informacje o modelu</span></div>
            <div class="small" id="llm_financial_info_name">—</div>
            <div id="llm_financial_info_body" class="small muted" style="margin-top:6px;"></div>
            <div class="llm-warn llm-inline-warn" id="llm_financial_info_warning" style="display:none"></div>
          </div>
        </div>
      </div>

      <div class="hr"></div>

      <!-- SPECIALIZED -->
      <div class="llm-row llm-group">
        <div>
          <div class="label" data-i18n="settings.llm_specialized_title"><i data-icon="wrench" data-size="14"></i> Specjalistyczne (prawne, advanced)</div>
          <div class="small muted" data-i18n="settings.llm_specialized_desc">Modele prawne (umowy), advanced reasoning.</div>
          <select id="llm_specialized_select" class="input"></select>

          <div class="llm-install-row">
            <button class="btn primary mini" type="button" id="llm_specialized_install_btn" style="display:none;"><i data-icon="install" data-size="14"></i> <span data-i18n="settings.llm_install">Instaluj</span></button>
            <span class="small muted" id="llm_specialized_warn"></span>
          </div>
        </div>

        <div>
          <div class="llm-info-box">
            <div class="llm-info-title small"><i data-icon="info_circle" data-size="14"></i> <span data-i18n="settings.llm_info_inline">Informacje o modelu</span></div>
            <div class="small" id="llm_specialized_info_name">—</div>
            <div id="llm_specialized_info_body" class="small muted" style="margin-top:6px;"></div>
            <div class="llm-warn llm-inline-warn" id="llm_specialized_info_warning" style="display:none"></div>
          </div>
        </div>
      </div>

      <div class="hr"></div>

      <!-- PROOFREADING / LANGUAGE CORRECTION -->
      <div class="llm-row llm-group">
        <div>
          <div class="label" data-i18n="settings.llm_proofreading_title"><i data-icon="edit" data-size="14"></i> Korekta językowa</div>
          <div class="small muted" data-i18n="settings.llm_proofreading_desc">Modele do korekty gramatycznej, stylistycznej i ortograficznej (PL/EN).</div>
          <select id="llm_proofreading_select" class="input"></select>

          <div class="llm-install-row">
            <button class="btn primary mini" type="button" id="llm_proofreading_install_btn" style="display:none;"><i data-icon="install" data-size="14"></i> <span data-i18n="settings.llm_install">Instaluj</span></button>
            <span class="small muted" id="llm_proofreading_warn"></span>
          </div>
        </div>

        <div>
          <div class="llm-info-box">
            <div class="llm-info-title small"><i data-icon="info_circle" data-size="14"></i> <span data-i18n="settings.llm_info_inline">Informacje o modelu</span></div>
            <div class="small" id="llm_proofreading_info_name">—</div>
            <div id="llm_proofreading_info_body" class="small muted" style="margin-top:6px;"></div>
            <div class="llm-warn llm-inline-warn" id="llm_proofreading_info_warning" style="display:none"></div>
          </div>
        </div>
      </div>

      <div class="hr"></div>

      <!-- CUSTOM / USER MODEL -->
      <div class="llm-row llm-group">
        <div style="grid-column: 1 / -1;">
          <div class="label" data-i18n="settings.llm_custom_title"><i data-icon="add" data-size="14"></i> Dodaj własny model Ollama</div>
          <div class="small muted" data-i18n="settings.llm_custom_desc">Wpisz dowolny model zainstalowany lub dostępny w Ollama (np. phi4:latest). Możesz go dodać do wybranej grupy.</div>

          <div style="display:flex; gap:8px; align-items:center; margin-top:8px; flex-wrap:wrap;">
            <select id="llm_custom_group" class="input" style="max-width:220px;">
              <option value="deep" data-i18n="settings.llm_group_deep">Głęboka analiza</option>
              <option value="quick" data-i18n="settings.llm_group_quick">Szybka analiza</option>
              <option value="vision" data-i18n="settings.llm_group_vision">Vision / OCR</option>
              <option value="translation" data-i18n="settings.llm_group_translation">Tłumaczenia</option>
              <option value="financial" data-i18n="settings.llm_group_financial">Finanse</option>
              <option value="specialized" data-i18n="settings.llm_group_specialized">Specjalistyczne</option>
              <option value="proofreading" data-i18n="settings.llm_group_proofreading">Korekta językowa</option>
            </select>
            <input id="llm_custom_model_id" class="input" type="text" placeholder="np. phi4:latest, llama3.2:1b, mymodel:tag" style="flex:1; min-width:260px;">
            <button class="btn primary mini" type="button" id="llm_custom_add_btn"><i data-icon="add" data-size="14"></i> <span data-i18n="settings.llm_custom_add">Dodaj</span></button>
          </div>

          <div class="small muted" id="llm_custom_msg" style="margin-top:6px;"></div>
          <div class="small" id="llm_custom_list" style="margin-top:8px;"></div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/settings_models.js?v={{ app_version }}&_={{ static_ts }}"></script>
<script>
  // Ensure translated labels are applied (base already calls applyI18n).
  applyI18n();
</script>
{% endblock %}
