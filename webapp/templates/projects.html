{% extends "base.html" %}
{% block content %}
<div class="card" id="projectsApp">

  <!-- ===== WORKSPACE LIST VIEW ===== -->
  <div id="viewWorkspaceList">
    <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:10px;margin-bottom:12px">
      <div>
        <div class="label" style="font-weight:900;color:var(--text);font-size:18px" data-i18n="projects.title">Twoje projekty</div>
        <div class="small" data-i18n="projects.subtitle">Workspace'y i podprojekty</div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn" id="btnNewWorkspace" type="button">+ Nowy projekt</button>
        <button class="btn secondary" id="btnImportProject" type="button" style="font-size:.85rem" data-i18n="projects.import.btn">Import</button>
        <input id="importAistateFile" type="file" accept=".aistate" style="display:none"/>
      </div>
    </div>

    <!-- Pending invitations -->
    <div id="invitationsSection" style="display:none">
      <div class="label" style="font-weight:700;color:var(--accent);margin-bottom:6px">
        <span>üì©</span> <span data-i18n="projects.invitations">Zaproszenia</span> (<span id="invCount">0</span>)
      </div>
      <div id="invitationsList" style="display:flex;flex-direction:column;gap:8px;margin-bottom:16px"></div>
    </div>

    <!-- Active workspaces -->
    <div id="activeSection">
      <div class="label" style="font-weight:700;margin-bottom:6px" data-i18n="projects.active">Aktywne</div>
      <div id="workspaceList" style="display:flex;flex-direction:column;gap:8px"></div>
      <div id="workspaceEmpty" class="small" style="display:none;padding:20px;text-align:center;opacity:.6" data-i18n="projects.no_projects">Brak projekt√≥w. Utw√≥rz nowy!</div>
    </div>

    <!-- Archived -->
    <div id="archivedSection" style="display:none;margin-top:16px">
      <div class="hr"></div>
      <details>
        <summary class="label" style="cursor:pointer;font-weight:700;margin-bottom:6px" data-i18n="projects.archived">Zarchiwizowane</summary>
        <div id="archivedList" style="display:flex;flex-direction:column;gap:8px;margin-top:8px"></div>
      </details>
    </div>
  </div>

  <!-- ===== WORKSPACE DETAIL VIEW ===== -->
  <div id="viewWorkspaceDetail" style="display:none">
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:12px;flex-wrap:wrap">
      <button class="btn secondary" id="btnBackToList" type="button" style="padding:4px 12px">‚óÄ Projekty</button>
      <div>
        <div class="label" style="font-weight:900;color:var(--text);font-size:18px" id="wsDetailName">‚Äî</div>
        <div class="small" id="wsDetailDesc"></div>
      </div>
      <div style="flex:1"></div>
      <div class="small" id="wsDetailRole" style="font-weight:700;padding:3px 10px;border-radius:8px;background:var(--accent);color:#fff"></div>
    </div>

    <div style="display:grid;grid-template-columns:1fr 280px;gap:16px;align-items:start" id="wsDetailGrid">
      <!-- LEFT: Subprojects -->
      <div>
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
          <div class="label" style="font-weight:700" data-i18n="projects.subprojects">Podprojekty</div>
          <button class="btn" id="btnNewSubproject" type="button" style="font-size:.85rem;padding:4px 14px">+ Nowy</button>
        </div>
        <div id="subprojectList" style="display:flex;flex-direction:column;gap:8px"></div>
        <div id="subprojectEmpty" class="small" style="display:none;padding:20px;text-align:center;opacity:.6" data-i18n="projects.no_subprojects">Brak podprojekt√≥w.</div>
      </div>

      <!-- RIGHT: Team + Activity -->
      <div>
        <div class="subcard" style="margin-bottom:12px">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px">
            <div class="label" style="font-weight:700" data-i18n="projects.team">Zesp√≥≈Ç</div>
            <button class="btn secondary" id="btnInviteUser" type="button" style="font-size:.78rem;padding:3px 10px">+ Zapro≈õ</button>
          </div>
          <div id="membersList" style="display:flex;flex-direction:column;gap:4px"></div>
        </div>
        <div class="subcard">
          <div class="label" style="font-weight:700;margin-bottom:6px" data-i18n="projects.activity">Aktywno≈õƒá</div>
          <div id="activityList" style="max-height:260px;overflow-y:auto;font-size:.82rem"></div>
        </div>
        <div style="margin-top:12px;display:flex;gap:6px;flex-wrap:wrap">
          <button class="btn secondary" id="btnArchiveWorkspace" type="button" style="font-size:.78rem" data-i18n="projects.archive">Archiwizuj</button>
          <button class="btn danger" id="btnDeleteWorkspace" type="button" style="font-size:.78rem" data-i18n="projects.delete_ws">Usu≈Ñ</button>
        </div>

        <!-- Subproject actions: Export / Delete -->
        <div class="subcard" style="margin-top:12px">
          <div class="label" style="font-weight:700;margin-bottom:6px">ZarzƒÖdzanie podprojektami</div>
          <div style="display:flex;gap:6px;flex-wrap:wrap">
            <button class="btn secondary" id="btnExportSubproject" type="button" style="font-size:.78rem">Eksportuj podprojekt</button>
            <button class="btn danger" id="btnDeleteSubproject" type="button" style="font-size:.78rem">Usu≈Ñ podprojekt</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ===== MODAL: New Workspace ===== -->
<div id="modalNewWorkspace" class="modal-overlay" style="display:none">
  <div class="modal-panel" style="max-width:440px">
    <div class="modal-header">
      <div class="modal-title">Nowy projekt</div>
      <button class="btn secondary modal-close-x" type="button">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="label">Nazwa</div>
      <input class="input" id="nwName" type="text" placeholder="np. ≈öledztwo KRS-2026"/>
      <div class="label" style="margin-top:10px">Opis (opcjonalnie)</div>
      <textarea class="input" id="nwDesc" rows="2" placeholder="Kr√≥tki opis projektu..."></textarea>
      <div class="label" style="margin-top:10px">Kolor</div>
      <div id="nwColors" style="display:flex;gap:6px;flex-wrap:wrap">
        <span class="color-chip active" data-color="#4a6cf7" style="background:#4a6cf7"></span>
        <span class="color-chip" data-color="#27ae60" style="background:#27ae60"></span>
        <span class="color-chip" data-color="#e74c3c" style="background:#e74c3c"></span>
        <span class="color-chip" data-color="#f39c12" style="background:#f39c12"></span>
        <span class="color-chip" data-color="#8e44ad" style="background:#8e44ad"></span>
        <span class="color-chip" data-color="#1abc9c" style="background:#1abc9c"></span>
        <span class="color-chip" data-color="#e67e22" style="background:#e67e22"></span>
        <span class="color-chip" data-color="#2c3e50" style="background:#2c3e50"></span>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn secondary modal-close-x" type="button">Anuluj</button>
      <button class="btn" id="nwSubmit" type="button">Utw√≥rz</button>
    </div>
  </div>
</div>

<!-- ===== MODAL: New Subproject ===== -->
<div id="modalNewSubproject" class="modal-overlay" style="display:none">
  <div class="modal-panel" style="max-width:480px">
    <div class="modal-header">
      <div class="modal-title">Nowy podprojekt</div>
      <button class="btn secondary modal-close-x" type="button">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="label">Nazwa</div>
      <input class="input" id="nsName" type="text" placeholder="np. Przes≈Çuchanie ≈õwiadka A"/>
      <div class="label" style="margin-top:10px">Typ</div>
      <div id="nsTypes" style="display:grid;grid-template-columns:repeat(3,1fr);gap:6px">
        <button class="btn secondary sp-type-btn active" data-type="transcription">üé§ Transkrypcja</button>
        <button class="btn secondary sp-type-btn" data-type="diarization">üë• Diaryzacja</button>
        <button class="btn secondary sp-type-btn" data-type="analysis">üìä Analiza</button>
        <button class="btn secondary sp-type-btn" data-type="chat">üí¨ Chat</button>
        <button class="btn secondary sp-type-btn" data-type="translation">üåê T≈Çumaczenie</button>
        <button class="btn secondary sp-type-btn" data-type="finance">üè¶ Finanse</button>
      </div>
      <div class="label" style="margin-top:10px">PowiƒÖ≈º z (opcjonalnie)</div>
      <select class="input" id="nsLinkTo"><option value="">‚Äî brak ‚Äî</option></select>
    </div>
    <div class="modal-footer">
      <button class="btn secondary modal-close-x" type="button">Anuluj</button>
      <button class="btn" id="nsSubmit" type="button">Utw√≥rz</button>
    </div>
  </div>
</div>

<!-- ===== MODAL: Invite User ===== -->
<div id="modalInviteUser" class="modal-overlay" style="display:none">
  <div class="modal-panel" style="max-width:420px">
    <div class="modal-header">
      <div class="modal-title">Zapro≈õ do projektu</div>
      <button class="btn secondary modal-close-x" type="button">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="label">Nazwa u≈ºytkownika</div>
      <input class="input" id="invUsername" type="text" placeholder="Wpisz nazwƒô u≈ºytkownika..."/>
      <div class="label" style="margin-top:10px">Rola</div>
      <div style="display:flex;flex-direction:column;gap:4px" id="invRoles">
        <label class="small" style="cursor:pointer"><input type="radio" name="invRole" value="viewer" checked> <b>Viewer</b> ‚Äî tylko podglƒÖd</label>
        <label class="small" style="cursor:pointer"><input type="radio" name="invRole" value="commenter"> <b>Commenter</b> ‚Äî podglƒÖd + notatki</label>
        <label class="small" style="cursor:pointer"><input type="radio" name="invRole" value="editor"> <b>Editor</b> ‚Äî edycja tre≈õci</label>
        <label class="small" style="cursor:pointer"><input type="radio" name="invRole" value="manager"> <b>Manager</b> ‚Äî edycja + zarzƒÖdzanie</label>
      </div>
      <div class="label" style="margin-top:10px">Wiadomo≈õƒá (opcjonalnie)</div>
      <textarea class="input" id="invMessage" rows="2" placeholder="Proszƒô o review..."></textarea>
    </div>
    <div class="modal-footer">
      <button class="btn secondary modal-close-x" type="button">Anuluj</button>
      <button class="btn" id="invSubmit" type="button">Wy≈õlij zaproszenie</button>
    </div>
  </div>
</div>

<!-- ===== MODAL: Delete Subproject ===== -->
<div id="modalDeleteSubproject" class="modal-overlay" style="display:none">
  <div class="modal-panel" style="max-width:480px">
    <div class="modal-header">
      <div class="modal-title" data-i18n="projects.delete.modal.title">Usu≈Ñ podprojekt</div>
      <button class="btn secondary modal-close-x" type="button">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="label" data-i18n="projects.delete.modal.choose">Wybierz podprojekt do usuniƒôcia</div>
      <select id="delSubSelect" class="input"></select>

      <div class="hr"></div>

      <div class="label" data-i18n="projects.delete.modal.method">Metoda nadpisywania</div>
      <select id="delSubWipeMethod" class="input">
        <option value="none" data-i18n="projects.delete.wipe.none">Szybkie (bez nadpisywania)</option>
        <option value="random1" data-i18n="projects.delete.wipe.random1">Pseudolosowy (1x)</option>
        <option value="hmg_is5" data-i18n="projects.delete.wipe.hmg">British HMG IS5 (3x)</option>
        <option value="gutmann" data-i18n="projects.delete.wipe.gutmann">Gutmann (35x)</option>
      </select>
      <div class="small" data-i18n="projects.delete.modal.note">Uwaga: na SSD/VM/CoW nadpisywanie mo≈ºe nie gwarantowaƒá pe≈Çnego ‚Äûsecure erase".</div>
    </div>
    <div class="modal-footer">
      <button class="btn secondary modal-close-x" type="button" data-i18n="common.cancel">Anuluj</button>
      <button class="btn danger" id="delSubConfirm" type="button" data-i18n="projects.delete.modal.confirm">Usu≈Ñ</button>
    </div>
  </div>
</div>

<!-- ===== MODAL: Export Subproject ===== -->
<div id="modalExportSubproject" class="modal-overlay" style="display:none">
  <div class="modal-panel" style="max-width:420px">
    <div class="modal-header">
      <div class="modal-title">Eksportuj podprojekt</div>
      <button class="btn secondary modal-close-x" type="button">‚úï</button>
    </div>
    <div class="modal-body">
      <div class="label">Wybierz podprojekt</div>
      <select id="expSubSelect" class="input"></select>
      <div class="small" style="margin-top:8px">Podprojekt zostanie wyeksportowany jako plik <code>.aistate</code>.</div>
    </div>
    <div class="modal-footer">
      <button class="btn secondary modal-close-x" type="button">Anuluj</button>
      <button class="btn" id="expSubConfirm" type="button">Eksportuj</button>
    </div>
  </div>
</div>

</div>

{% endblock %}

{% block scripts %}
<script src="/static/projects.js?v={{ app_version }}"></script>
{% endblock %}
