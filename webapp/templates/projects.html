{% extends "base.html" %}
{% block content %}
<style>
.sp-type-btn{
  display:flex;align-items:center;justify-content:center;
  padding:10px !important;min-width:0;width:46px;height:46px;
  border:2px solid transparent;border-radius:10px;
  transition:border-color .15s,background .15s,box-shadow .15s;
  opacity:.55;
}
.sp-type-btn:hover{opacity:.85;background:rgba(0,212,255,.06)}
.sp-type-btn.active{
  opacity:1;
  border-color:rgba(0,212,255,.4);
  background:rgba(0,212,255,.08);
  box-shadow:0 0 8px rgba(0,212,255,.15);
}
.sp-type-btn img{width:28px;height:28px}

/* Project card — compact 3-section layout */
.sp-card{cursor:pointer;transition:transform .15s;padding:10px 12px !important}
.sp-card-row{
  display:grid;
  grid-template-columns:1fr auto auto auto auto;
  align-items:center;gap:10px;
}
.sp-card-info{min-width:140px;overflow:hidden}
.sp-card-info>div:first-child{
  font-weight:700;font-size:.82rem;
  white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
}
.sp-card-team{
  width:110px;
  display:flex;flex-direction:column;gap:1px;
  overflow:hidden;
}
.sp-card-actions{
  display:flex;gap:3px;align-items:center;
}
.sp-card-sep{
  width:1px;height:24px;background:#d0d5dd;opacity:.40;
  flex-shrink:0;
}
</style>

<div class="analysis-page projects-page">

  <!-- ===== TOOLBAR ===== -->
  <div class="card analysis-toolbar projects-toolbar" id="projects_toolbar">
    <div class="analysis-toolbar-left">
      <div class="h1" style="margin:0"><img src="/static/icons/sidebar/projects.svg" alt="" draggable="false" style="width:36px;height:36px;vertical-align:middle;margin-right:4px"> <span data-i18n="projects.title">Projekty</span></div>
      <div class="small" id="projects_status_line"></div>
    </div>

    <div class="analysis-toolbar-right">

      <!-- Sekcja 1: Nowy / Import / Export / Zaproś -->
      <div class="toolbar-section" id="toolbarActions1">
        <button class="btn pill-icon" id="btnNewProject" title="Nowy projekt"><img src="/static/icons/projekty/project_subproject.svg" alt="Nowy projekt" draggable="false"></button>
        <button class="btn pill-icon" id="btnImportProject" title="Import" data-i18n-title="projects.import.btn"><img src="/static/icons/pliki/file_import.svg" alt="Import" draggable="false"></button>
        <input id="importAistateFile" type="file" accept=".aistate" style="display:none"/>
        <button class="btn pill-icon" id="btnExportProject" title="Eksportuj projekt"><img src="/static/icons/pliki/file_export.svg" alt="Eksportuj" draggable="false"></button>
        <button class="btn pill-icon" id="btnInviteUser" title="Zaproś użytkownika"><img src="/static/icons/uzytkownicy/user_invite.svg" alt="Zaproś" draggable="false"></button>
      </div>

      <div class="toolbar-sep"></div>

      <!-- Sekcja 2: Usuń -->
      <div class="toolbar-section" id="toolbarActions2">
        <button class="btn pill-icon" id="btnDeleteProject" title="Usuń projekt"><img src="/static/icons/akcje/remove.svg" alt="Usuń" draggable="false"></button>
      </div>

    </div>
  </div>

  <!-- ===== CONTENT ===== -->
  <div class="card" id="projectsApp">

    <div id="projectsGrid">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px">
        <div class="label" style="font-weight:700" data-i18n="projects.subprojects">Projekty</div>
      </div>
      <div id="projectList" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(400px,1fr));gap:8px"></div>
      <div id="projectEmpty" class="small" style="display:none;padding:20px;text-align:center;opacity:.6">Brak projektów. Utwórz nowy!</div>
    </div>

  </div>
</div>

<!-- ===== MODAL: New Project ===== -->
<div id="modalNewProject" class="modal-overlay" style="display:none">
  <div class="modal-panel" style="max-width:480px">
    <div class="modal-header">
      <div class="modal-title">Nowy projekt</div>
      <button class="btn secondary modal-close-x" type="button"><i data-icon="close" data-size="16"></i></button>
    </div>
    <div class="modal-body">
      <div class="label">Nazwa</div>
      <input class="input" id="npName" type="text" placeholder="np. Przesłuchanie świadka A"/>
      <div class="label" style="margin-top:10px">Typ</div>
      <div id="npTypes" style="display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn secondary sp-type-btn active" data-type="transcription" title="Transkrypcja"><img src="/static/icons/sidebar/transcription.svg" draggable="false"></button>
        <button class="btn secondary sp-type-btn" data-type="diarization" title="Diaryzacja"><img src="/static/icons/sidebar/diarization.svg" draggable="false"></button>
        <button class="btn secondary sp-type-btn" data-type="analysis" title="Analiza"><img src="/static/icons/sidebar/analysis.svg" draggable="false"></button>
        <button class="btn secondary sp-type-btn" data-type="chat" title="Chat"><img src="/static/icons/sidebar/chat.svg" draggable="false"></button>
        <button class="btn secondary sp-type-btn" data-type="translation" title="Tłumaczenie"><img src="/static/icons/sidebar/translation.svg" draggable="false"></button>
        <button class="btn secondary sp-type-btn" data-type="general" title="Ogólny"><img src="/static/icons/projekty/subproject_new.svg" draggable="false"></button>
      </div>
      <div class="label" style="margin-top:10px">Powiąż z (opcjonalnie)</div>
      <select class="input" id="npLinkTo"><option value="">— brak —</option></select>
    </div>
    <div class="modal-footer">
      <button class="btn secondary modal-close-x" type="button">Anuluj</button>
      <button class="btn" id="npSubmit" type="button">Utwórz</button>
    </div>
  </div>
</div>

<!-- ===== MODAL: Invite User ===== -->
<div id="modalInviteUser" class="modal-overlay" style="display:none">
  <div class="modal-panel" style="max-width:420px">
    <div class="modal-header">
      <div class="modal-title">Zaproś do projektu</div>
      <button class="btn secondary modal-close-x" type="button"><i data-icon="close" data-size="16"></i></button>
    </div>
    <div class="modal-body">
      <div class="label">Projekt</div>
      <select class="input" id="invProject"><option value="">— wszystkie projekty —</option></select>
      <div class="label" style="margin-top:10px">Nazwa użytkownika</div>
      <input class="input" id="invUsername" type="text" placeholder="Wpisz nazwę użytkownika..."/>
      <div class="label" style="margin-top:10px">Rola</div>
      <div style="display:flex;flex-direction:column;gap:4px" id="invRoles">
        <label class="small" style="cursor:pointer"><input type="radio" name="invRole" value="viewer" checked> <b>Viewer</b> — tylko podgląd</label>
        <label class="small" style="cursor:pointer"><input type="radio" name="invRole" value="editor"> <b>Editor</b> — edycja treści</label>
        <label class="small" style="cursor:pointer"><input type="radio" name="invRole" value="manager"> <b>Manager</b> — edycja + zarządzanie</label>
      </div>
      <div class="label" style="margin-top:10px">Wiadomość (opcjonalnie)</div>
      <textarea class="input" id="invMessage" rows="2" placeholder="Proszę o review..."></textarea>
    </div>
    <div class="modal-footer">
      <button class="btn secondary modal-close-x" type="button">Anuluj</button>
      <button class="btn" id="invSubmit" type="button">Wyślij zaproszenie</button>
    </div>
  </div>
</div>

<!-- ===== MODAL: Delete Project ===== -->
<div id="modalDeleteProject" class="modal-overlay" style="display:none">
  <div class="modal-panel" style="max-width:480px">
    <div class="modal-header">
      <div class="modal-title">Usuń projekt</div>
      <button class="btn secondary modal-close-x" type="button"><i data-icon="close" data-size="16"></i></button>
    </div>
    <div class="modal-body">
      <div class="label">Wybierz projekt do usunięcia</div>
      <select id="delProjSelect" class="input"></select>

      <div class="hr"></div>

      <div class="label">Metoda nadpisywania</div>
      <select id="delProjWipeMethod" class="input">
        <option value="none">Szybkie (bez nadpisywania)</option>
        <option value="random1">Pseudolosowy (1x)</option>
        <option value="hmg_is5">British HMG IS5 (3x)</option>
        <option value="gutmann">Gutmann (35x)</option>
      </select>
      <div class="small">Uwaga: na SSD/VM/CoW nadpisywanie może nie gwarantować pełnego „secure erase".</div>
    </div>
    <div class="modal-footer">
      <button class="btn secondary modal-close-x" type="button">Anuluj</button>
      <button class="btn danger" id="delProjConfirm" type="button">Usuń</button>
    </div>
  </div>
</div>

<!-- ===== MODAL: Export Project ===== -->
<div id="modalExportProject" class="modal-overlay" style="display:none">
  <div class="modal-panel" style="max-width:420px">
    <div class="modal-header">
      <div class="modal-title">Eksportuj projekt</div>
      <button class="btn secondary modal-close-x" type="button"><i data-icon="close" data-size="16"></i></button>
    </div>
    <div class="modal-body">
      <div class="label">Wybierz projekt</div>
      <select id="expProjSelect" class="input"></select>
      <div class="small" style="margin-top:8px">Projekt zostanie wyeksportowany jako plik <code>.aistate</code>.</div>
    </div>
    <div class="modal-footer">
      <button class="btn secondary modal-close-x" type="button">Anuluj</button>
      <button class="btn" id="expProjConfirm" type="button">Eksportuj</button>
    </div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script src="/static/projects.js?v={{ app_version }}&_={{ static_ts }}"></script>
{% endblock %}
